<!DOCTYPE html><html><head><title>Hypem Player</title><link rel="stylesheet" type="text/css" href="css/style.css"><script type="text/javascript" charset="utf-8" src="js/jquery.min.js"></script><script type="text/javascript" src="js/underscore.min.js"></script><script src="cordova-2.7.0.js"></script></head><body><div class="container"><div class="songInfo"><div class="songName"><p id="songName"></p></div><div class="songArtist"><p id="songArtist"></p></div></div><div class="songArtwork"><img id="songArtwork"></div><div class="mediaPlayer"><audio id="player" controls></audio></div><div class="mediaControl"><button id="nextSong" type="button">-></button><button id="previousSong" type="button"><-</button></div><div id="playListController"><button id="popular" type="button" disabled>Popular</button><button id="latest" type="button">Latest</button></div></div><script type="text/javascript">
(function() {
  var Player, player,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Player = (function() {
    function Player() {
      this.getCurrentPlaylist = __bind(this.getCurrentPlaylist, this);
      this.playListController = __bind(this.playListController, this);
      this.previousSongController = __bind(this.previousSongController, this);
      this.nextSongController = __bind(this.nextSongController, this);
      this.playerController = __bind(this.playerController, this);
      this.getSongUrl = __bind(this.getSongUrl, this);
      this.getPlayList = __bind(this.getPlayList, this);
      this.initialize = __bind(this.initialize, this);      this.playlist = [];
      this.currentList = 'popular';
      this.currentPage = 1;
      this.currentSong = 0;
      this.hypemPrefixAPI = 'http://hypem.com/playlist/';
      this.hypemMidAPI = '/all/json/';
      this.hypemSufixAPI = '/data.js';
      this.initialize();
    }

    Player.prototype.initialize = function() {
      return this.getPlayList();
    };

    Player.prototype.getPlayList = function() {
      var _this = this;

      return $.get(this.hypemPrefixAPI + this.currentList + this.hypemMidAPI + this.currentPage + this.hypemSufixAPI, function(res) {
        var key, _i, _len, _ref;

        _ref = _.keys(res);
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          key = _ref[_i];
          if (key !== 'version') {
            _this.playlist.push({
              mediaid: res[key].mediaid,
              photo: res[key].thumb_url_large,
              artist: res[key].artist,
              title: res[key].title
            });
          }
        }
        return _this.getSongUrl();
      }, 'json');
    };

    Player.prototype.getSongUrl = function() {
      var _this = this;

      return $.get('http://hypem-server.herokuapp.com/?mediaid=' + this.playlist[this.currentSong].mediaid, function(res) {
        console.log(res.url);
        return _this.playerController(res.url);
      }, 'jsonp');
    };

    Player.prototype.playerController = function(url) {
      $('#player').attr('src', url);
      $('#songName').text(this.playlist[this.currentSong].title);
      $('#songArtist').text(this.playlist[this.currentSong].artist);
      return $('#songArtwork').attr('src', this.playlist[this.currentSong].photo);
    };

    Player.prototype.nextSongController = function() {
      this.currentSong += 1;
      if (this.currentSong !== 0 && this.currentSong % 30 === 0) {
        this.currentSong += 1;
        return this.getPlayList();
      } else {
        return this.getSongUrl();
      }
    };

    Player.prototype.previousSongController = function() {
      if (this.currentSong !== 0) {
        this.currentSong -= 1;
        return this.getSongUrl();
      }
    };

    Player.prototype.playListController = function(playlist) {
      this.currentList = playlist;
      this.playlist = [];
      this.currentPage = 1;
      this.currentSong = 0;
      return this.getPlayList();
    };

    Player.prototype.getCurrentPlaylist = function() {
      return this.currentList;
    };

    return Player;

  })();

  player = new Player;

  $('#playListController').click(function(e) {
    if (e.target.id !== 'playListController' && e.target.id !== player.getCurrentPlaylist()) {
      $('#' + player.getCurrentPlaylist()).removeAttr('disabled');
      player.playListController(e.target.id);
      return $('#' + e.target.id).attr('disabled', 'disabled');
    }
  });

  $('#nextSong').click(function(e) {
    return player.nextSongController();
  });

  $('#previousSong').click(function(e) {
    return player.previousSongController();
  });

  $('#player').bind('ended', function() {
    return player.nextSongController();
  });

}).call(this);
</script></body></html>